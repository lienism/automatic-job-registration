[
  {
    "Id": "221729",
    "ThreadId": "65116",
    "Html": "<p>I'm trying to schedule a task that will work regardless of whether the target box is v1 or v2 Task Scheduler. I'm hoping I can use the same section of code for both, but I'm having trouble. Here's what I tried 1st, which worked on a v2 target box:</p>\r\n<div style=\"color:Black;background-color:White\">\r\n<pre><span style=\"color:Blue\">using</span> (<span style=\"color:Blue\">var</span> action = <span style=\"color:Blue\">new</span> ExecAction(appName, appParams, <span style=\"color:Blue\">null</span>))\r\n{\r\n    <span style=\"color:Blue\">using</span> (<span style=\"color:Blue\">var</span> service = <span style=\"color:Blue\">new</span> TaskService(boxUncName))\r\n    {\r\n        <span style=\"color:Blue\">var</span> definition = service.NewTask();\r\n        definition.Actions.Add(action);\r\n        definition.Settings.AllowHardTerminate = <span style=\"color:Blue\">false</span>;\r\n        definition.Settings.DeleteExpiredTaskAfter = TimeSpan.FromSeconds(1);\r\n        definition.Principal.LogonType = TaskLogonType.InteractiveToken;\r\n        <span style=\"color:Blue\">using</span> (<span style=\"color:Blue\">var</span> trigger = <span style=\"color:Blue\">new</span> TimeTrigger())\r\n        {\r\n            definition.Triggers.Add(trigger);\r\n            trigger.StartBoundary = DateTime.Now.AddMinutes(2);\r\n            trigger.EndBoundary = trigger.StartBoundary.AddHours(12);\r\n            service.RootFolder.RegisterTaskDefinition(taskName, definition);\r\n        }\r\n    }\r\n}\r\n\r\n</pre>\r\n</div>\r\n<div style=\"color:Black;background-color:White\">\r\n<pre>When I ran this against a v1 target box (Windows Server 2003), I got &quot;System.Runtime.InteropServices.COMException (0x80041318): The task XML contains a value which is incorrectly formatted or out of range.&quot;</pre>\r\n<pre>I tried logging the XmlText from the TaskDefinition at that point and got this:</pre>\r\n<pre><div style=\"color:Black;background-color:White\"><pre><span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Task</span> <span style=\"color:Red\">version</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">1.1</span><span style=\"color:Black\">&quot;</span> <span style=\"color:Red\">xmlns</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">http://schemas.microsoft.com/windows/2004/02/mit/task</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">&gt;</span>\r\n  <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">RegistrationInfo</span> <span style=\"color:Blue\">/&gt;</span>\r\n  <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Triggers</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">TimeTrigger</span><span style=\"color:Blue\">&gt;</span>\r\n      <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">StartBoundary</span><span style=\"color:Blue\">&gt;</span>2009-08-10T13:46:33.031<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">StartBoundary</span><span style=\"color:Blue\">&gt;</span>\r\n      <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">EndBoundary</span><span style=\"color:Blue\">&gt;</span>2009-08-11T01:46:33.031<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">EndBoundary</span><span style=\"color:Blue\">&gt;</span>\r\n      <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Enabled</span><span style=\"color:Blue\">&gt;</span>true<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Enabled</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">TimeTrigger</span><span style=\"color:Blue\">&gt;</span>\r\n  <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Triggers</span><span style=\"color:Blue\">&gt;</span>\r\n  <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Settings</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">IdleSettings</span><span style=\"color:Blue\">&gt;</span>\r\n      <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Duration</span><span style=\"color:Blue\">&gt;</span>PT10M<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Duration</span><span style=\"color:Blue\">&gt;</span>\r\n      <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">WaitTimeout</span><span style=\"color:Blue\">&gt;</span>PT1H<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">WaitTimeout</span><span style=\"color:Blue\">&gt;</span>\r\n      <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">StopOnIdleEnd</span><span style=\"color:Blue\">&gt;</span>true<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">StopOnIdleEnd</span><span style=\"color:Blue\">&gt;</span>\r\n      <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">RestartOnIdle</span><span style=\"color:Blue\">&gt;</span>false<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">RestartOnIdle</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">IdleSettings</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">DisallowStartIfOnBatteries</span><span style=\"color:Blue\">&gt;</span>true<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">DisallowStartIfOnBatteries</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">StopIfGoingOnBatteries</span><span style=\"color:Blue\">&gt;</span>true<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">StopIfGoingOnBatteries</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Enabled</span><span style=\"color:Blue\">&gt;</span>true<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Enabled</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Hidden</span><span style=\"color:Blue\">&gt;</span>false<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Hidden</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">RunOnlyIfIdle</span><span style=\"color:Blue\">&gt;</span>false<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">RunOnlyIfIdle</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">WakeToRun</span><span style=\"color:Blue\">&gt;</span>false<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">WakeToRun</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">ExecutionTimeLimit</span><span style=\"color:Blue\">&gt;</span>PT72H<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">ExecutionTimeLimit</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">DeleteExpiredTaskAfter</span><span style=\"color:Blue\">&gt;</span>PT1S<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">DeleteExpiredTaskAfter</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Priority</span><span style=\"color:Blue\">&gt;</span>7<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Priority</span><span style=\"color:Blue\">&gt;</span>\r\n  <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Settings</span><span style=\"color:Blue\">&gt;</span>\r\n  <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Actions</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Exec</span><span style=\"color:Blue\">&gt;</span>\r\n      <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Command</span><span style=\"color:Blue\">&gt;</span>g:\\ddfiles\\dev10\\tools\\20810.00\\razzle.cmd<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Command</span><span style=\"color:Blue\">&gt;</span>\r\n      <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Arguments</span><span style=\"color:Blue\">&gt;</span>x86 chk exec Release /create:sources<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Arguments</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Exec</span><span style=\"color:Blue\">&gt;</span>\r\n  <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Actions</span><span style=\"color:Blue\">&gt;</span>\r\n<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Task</span><span style=\"color:Blue\">&gt;</span>\r\n</pre>\r\n<pre>I also tried catching the exception and doing it a little differently in this situation:</pre>\r\n<pre><div style=\"color:Black;background-color:White\"><pre><span style=\"color:Blue\">using</span> (<span style=\"color:Blue\">var</span> service = <span style=\"color:Blue\">new</span> TaskService(boxUncName, <span style=\"color:Blue\">null</span>, <span style=\"color:Blue\">null</span>, <span style=\"color:Blue\">null</span>, <span style=\"color:Blue\">true</span>))\r\n{\r\n    <span style=\"color:Blue\">var</span> definition = service.NewTask();\r\n    definition.Actions.Add(action);\r\n    definition.Principal.LogonType = TaskLogonType.InteractiveToken;\r\n    definition.Settings.DeleteExpiredTaskAfter = TimeSpan.FromSeconds(1);\r\n    <span style=\"color:Blue\">using</span> (<span style=\"color:Blue\">var</span> trigger = <span style=\"color:Blue\">new</span> TimeTrigger())\r\n    {\r\n        definition.Triggers.Add(trigger);\r\n        trigger.StartBoundary = DateTime.Now.AddMinutes(2);\r\n        trigger.EndBoundary = trigger.StartBoundary.AddHours(12);\r\n        service.RootFolder.RegisterTaskDefinition(taskName, definition);\r\n    }\r\n}\r\n\r\nThat resulted in &quot;System.NullReferenceException: Object reference not set to an instance of an object. at Microsoft.Win32.TaskScheduler.ExecAction.Bind(ITask v1Task)&quot;.</pre>\r\n<pre>I'm running on a v2 host box. (Windows Server 2008.)</pre>\r\n<pre>Any suggestions?</pre>\r\n<pre>Thanks,</pre>\r\n<pre>Rick</pre>\r\n</div>\r\n</pre>\r\n</div>\r\n</pre>\r\n</div>",
    "PostedDate": "2009-08-10T14:40:54.467-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "221771",
    "ThreadId": "65116",
    "Html": "<p>Ok, I solved the NullReferenceException by creating a new ExecAction instead of re-using it. But I'd still like to know what is causing &quot;The task XML contains a value which is incorrectly formatted or out of range&quot; in hopes of creating the task correctly in the 1st place so that I don't have to catch the COMException.</p>\r\n<p>Thanks,</p>\r\n<p>Rick</p>",
    "PostedDate": "2009-08-10T16:38:19.55-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "222784",
    "ThreadId": "65116",
    "Html": "<p>You should note that&nbsp;<strong>definition.Settings.AllowHardTerminate</strong> is a v2 only property, so you can't even set it for v1 machines. When I run your first code example without that line,&nbsp;it works. I believe that is what is giving you the &quot;Out of range&quot; exception. I'm not sure about the other errors. Are you running against the latest download (1.3.1)? Unfortunately, I don't have a remote v1 system to try this against so I'll have to ask you to do some testing.</p>",
    "PostedDate": "2009-08-12T19:22:59.08-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "223055",
    "ThreadId": "65116",
    "Html": "<p>I removed the AllowHardTerminate and still have the same problem. (I'm using 1.3.1.) When I caught the COMException I logged the XmlText from the TaskDefinition:</p>\r\n<div style=\"color:Black;background-color:White\">\r\n<pre><span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Task</span> <span style=\"color:Red\">version</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">1.1</span><span style=\"color:Black\">&quot;</span> <span style=\"color:Red\">xmlns</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">http://schemas.microsoft.com/windows/2004/02/mit/task</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">&gt;</span>\r\n  <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">RegistrationInfo</span> <span style=\"color:Blue\">/&gt;</span>\r\n  <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Triggers</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">TimeTrigger</span><span style=\"color:Blue\">&gt;</span>\r\n      <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">StartBoundary</span><span style=\"color:Blue\">&gt;</span>2009-08-13T11:04:35.583<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">StartBoundary</span><span style=\"color:Blue\">&gt;</span>\r\n      <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">EndBoundary</span><span style=\"color:Blue\">&gt;</span>2009-08-13T23:04:00<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">EndBoundary</span><span style=\"color:Blue\">&gt;</span>\r\n      <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Enabled</span><span style=\"color:Blue\">&gt;</span>true<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Enabled</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">TimeTrigger</span><span style=\"color:Blue\">&gt;</span>\r\n  <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Triggers</span><span style=\"color:Blue\">&gt;</span>\r\n  <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Settings</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">IdleSettings</span><span style=\"color:Blue\">&gt;</span>\r\n      <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Duration</span><span style=\"color:Blue\">&gt;</span>PT10M<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Duration</span><span style=\"color:Blue\">&gt;</span>\r\n      <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">WaitTimeout</span><span style=\"color:Blue\">&gt;</span>PT1H<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">WaitTimeout</span><span style=\"color:Blue\">&gt;</span>\r\n      <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">StopOnIdleEnd</span><span style=\"color:Blue\">&gt;</span>true<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">StopOnIdleEnd</span><span style=\"color:Blue\">&gt;</span>\r\n      <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">RestartOnIdle</span><span style=\"color:Blue\">&gt;</span>false<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">RestartOnIdle</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">IdleSettings</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">DisallowStartIfOnBatteries</span><span style=\"color:Blue\">&gt;</span>true<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">DisallowStartIfOnBatteries</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">StopIfGoingOnBatteries</span><span style=\"color:Blue\">&gt;</span>true<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">StopIfGoingOnBatteries</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Enabled</span><span style=\"color:Blue\">&gt;</span>true<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Enabled</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Hidden</span><span style=\"color:Blue\">&gt;</span>false<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Hidden</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">RunOnlyIfIdle</span><span style=\"color:Blue\">&gt;</span>false<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">RunOnlyIfIdle</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">WakeToRun</span><span style=\"color:Blue\">&gt;</span>false<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">WakeToRun</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">ExecutionTimeLimit</span><span style=\"color:Blue\">&gt;</span>PT72H<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">ExecutionTimeLimit</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">DeleteExpiredTaskAfter</span><span style=\"color:Blue\">&gt;</span>PT1S<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">DeleteExpiredTaskAfter</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Priority</span><span style=\"color:Blue\">&gt;</span>7<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Priority</span><span style=\"color:Blue\">&gt;</span>\r\n  <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Settings</span><span style=\"color:Blue\">&gt;</span>\r\n  <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Actions</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Exec</span><span style=\"color:Blue\">&gt;</span>\r\n      <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Command</span><span style=\"color:Blue\">&gt;</span>g:\\ddfiles\\dev10\\tools\\20813.00\\razzle.cmd<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Command</span><span style=\"color:Blue\">&gt;</span>\r\n      <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Arguments</span><span style=\"color:Blue\">&gt;</span>x86 chk exec Release /create:sources<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Arguments</span><span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Exec</span><span style=\"color:Blue\">&gt;</span>\r\n  <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Actions</span><span style=\"color:Blue\">&gt;</span>\r\n<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Task</span><span style=\"color:Blue\">&gt;</span>\r\n</pre>\r\n</div>",
    "PostedDate": "2009-08-13T11:13:58.033-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]