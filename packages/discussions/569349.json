[
  {
    "Id": "1311690",
    "ThreadId": "569349",
    "Html": "I've searched a lot to try to resolve this issue.  It seems like I'm doing the correct things (td.Principal.LogonType = TaskLogonType.Password and providing a login/password).  The scheduled task is created but when I look at the scheduled task it always has the &quot;Run only if logged in&quot; checkbox checked.  If I uncheck that box and save it, it works perfectly.  So it seems like I'm close.<br />\n<br />\nHere's the code:<br />\n<div style=\"color:Black;background-color:White;\"><pre>\r\n    <span style=\"color:Blue;\">Sub</span> ScheduleWithTaskManager(Scheduleid <span style=\"color:Blue;\">As</span> <span style=\"color:Blue;\">Integer</span>, OneTime <span style=\"color:Blue;\">As</span> <span style=\"color:Blue;\">Boolean</span>)\n            <span style=\"color:Blue;\">Dim</span> onetimestring <span style=\"color:Blue;\">As</span> <span style=\"color:Blue;\">String</span> = <span style=\"color:#A31515;\">&quot;0&quot;</span>\n            <span style=\"color:Blue;\">If</span> OneTime <span style=\"color:Blue;\">Then</span> onetimestring = <span style=\"color:#A31515;\">&quot;1&quot;</span>\n\n            <span style=\"color:Blue;\">Using</span> ts <span style=\"color:Blue;\">As</span> <span style=\"color:Blue;\">New</span> TaskService(<span style=\"color:#A31515;\">&quot;&quot;</span>, <span style=\"color:#A31515;\">&quot;userid&quot;</span>, <span style=\"color:#A31515;\">&quot;domain&quot;</span>, <span style=\"color:#A31515;\">&quot;pwd&quot;</span>)\n                <span style=\"color:Green;\">&#39; Create a new task definition and assign properties</span>\n                <span style=\"color:Blue;\">Dim</span> td <span style=\"color:Blue;\">As</span> TaskDefinition = ts.NewTask\n                td.Principal.LogonType = TaskLogonType.Password\n                td.RegistrationInfo.Description = Scheduleid &amp; <span style=\"color:#A31515;\">&quot; - &quot;</span> &amp; Session(<span style=\"color:#A31515;\">&quot;ClientID&quot;</span>) &amp; <span style=\"color:#A31515;\">&quot; - &quot;</span> &amp; GetName(<span style=\"color:Blue;\">Me</span>.ddlPages.SelectedItem.Text)\n                td.Settings.RunOnlyIfLoggedOn = <span style=\"color:Blue;\">False</span>\n                <span style=\"color:Blue;\">If</span> OneTime <span style=\"color:Blue;\">Then</span>\n                    <span style=\"color:Blue;\">Dim</span> tt <span style=\"color:Blue;\">As</span> TimeTrigger = <span style=\"color:Blue;\">New</span> TimeTrigger\n                    tt.StartBoundary = GetNextExecution(OneTime)\n                    td.Triggers.Add(tt)\n                <span style=\"color:Blue;\">ElseIf</span> ddlPeriodUnits.SelectedValue = <span style=\"color:#A31515;\">&quot;Day&quot;</span> <span style=\"color:Blue;\">Then</span>\n                    <span style=\"color:Blue;\">Dim</span> dt <span style=\"color:Blue;\">As</span> DailyTrigger = <span style=\"color:Blue;\">New</span> DailyTrigger()\n                  \n                    dt.StartBoundary = GetNextExecution()\n                    dt.DaysInterval = 1\n                    td.Triggers.Add(dt)\n                <span style=\"color:Blue;\">ElseIf</span> ddlPeriodUnits.SelectedValue = <span style=\"color:#A31515;\">&quot;Week&quot;</span> <span style=\"color:Blue;\">Then</span>\n                    <span style=\"color:Blue;\">Dim</span> wt <span style=\"color:Blue;\">As</span> WeeklyTrigger = <span style=\"color:Blue;\">New</span> WeeklyTrigger\n                    wt.StartBoundary = GetNextExecution()\n                    wt.DaysOfWeek = GetDayoftheweek(ddlDayOf.SelectedValue)\n                    td.Triggers.Add(wt)\n                <span style=\"color:Blue;\">ElseIf</span> ddlPeriodUnits.SelectedValue = <span style=\"color:#A31515;\">&quot;Month&quot;</span> <span style=\"color:Blue;\">Then</span>\n                    <span style=\"color:Blue;\">Dim</span> mt <span style=\"color:Blue;\">As</span> MonthlyTrigger = <span style=\"color:Blue;\">New</span> MonthlyTrigger\n                    mt.StartBoundary = GetNextExecution()\n                    <span style=\"color:Blue;\">If</span> ddlDayOf.SelectedValue = 0 <span style=\"color:Blue;\">Then</span>\n                        mt.RunOnLastDayOfMonth = <span style=\"color:Blue;\">True</span>\n                    <span style=\"color:Blue;\">Else</span>\n                        <span style=\"color:Blue;\">Dim</span> dayof(1) <span style=\"color:Blue;\">As</span> <span style=\"color:Blue;\">Integer</span>\n                        dayof(0) = ddlDayOf.SelectedValue\n                        mt.DaysOfMonth = dayof\n                    <span style=\"color:Blue;\">End</span> <span style=\"color:Blue;\">If</span>\n                    td.Triggers.Add(mt)\n                    \n                <span style=\"color:Blue;\">End</span> <span style=\"color:Blue;\">If</span>\n              \n                <span style=\"color:Blue;\">Try</span>\n                    <span style=\"color:Green;\">&#39;td.Settings.RunOnlyIfLoggedOn = False</span>\n                    <span style=\"color:Blue;\">Dim</span> domain <span style=\"color:Blue;\">As</span> <span style=\"color:Blue;\">String</span> = <span style=\"color:#A31515;\">&quot;portal.securityondemand.com&quot;</span> <span style=\"color:Green;\">&#39;Request.ServerVariables(&quot;HTTP_HOST&quot;)</span>\n                    <span style=\"color:Blue;\">Dim</span> path <span style=\"color:Blue;\">As</span> <span style=\"color:Blue;\">String</span> = Server.MapPath(<span style=\"color:#A31515;\">&quot;~/bin&quot;</span>)\n                    <span style=\"color:Blue;\">Dim</span> arguments <span style=\"color:Blue;\">As</span> <span style=\"color:Blue;\">String</span> = onetimestring &amp; <span style=\"color:#A31515;\">&quot; &quot;</span> &amp; Scheduleid &amp; <span style=\"color:#A31515;\">&quot; 40 &quot;</span> &amp; domain\n                    td.Actions.Add(<span style=\"color:Blue;\">New</span> ExecAction(path &amp; <span style=\"color:#A31515;\">&quot;/RunReport.exe&quot;</span>, arguments, path))\n                    \n                    <span style=\"color:Green;\">&#39; Register the task in the root folder</span>\n                    ts.RootFolder.RegisterTaskDefinition(Scheduleid, td)\n                    \n                <span style=\"color:Blue;\">Catch</span> ex <span style=\"color:Blue;\">As</span> Exception\n                    lbErrMsg.Text = <span style=\"color:#A31515;\">&quot;Problem with registering with scheduler: &quot;</span> &amp; ex.Message\n                    \n                <span style=\"color:Blue;\">End</span> <span style=\"color:Blue;\">Try</span>\n \n            <span style=\"color:Blue;\">End</span> <span style=\"color:Blue;\">Using</span>\n\n        <span style=\"color:Blue;\">End</span> <span style=\"color:Blue;\">Sub</span>\r\n</pre></div>Thanks for any help on this.<br />\n",
    "PostedDate": "2014-10-08T13:58:22.76-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "1311819",
    "ThreadId": "569349",
    "Html": "You must add the username, password and special TaskLogonType. Like this example:\r<br />\nRegisterTaskDefinition(TaskName.Text, td, TaskCreation.CreateOrUpdate,<br />\n<pre><code>                                                     usercred.username, TDES.decryptString(usercred.password),\n                                                     TaskLogonType.Password);\n</code></pre>\n\nBill<br />\n",
    "PostedDate": "2014-10-09T04:18:51.047-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": "2014-10-22T23:00:57.387-07:00"
  }
]